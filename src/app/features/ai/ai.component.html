<div class="m-0 chat-container" #chatContainer>
  <div class="flex flex-column align-items-center pb-4 pt-2">
    <div class="chat-width">
      <div *ngFor="let msg of messages" class="m-3">
        <div
          [ngClass]="
            msg.sender === 'user'
              ? 'flex justify-content-end align-items-end gap-2'
              : 'flex justify-content-start align-items-end gap-2'
          "
        >
          <ng-container *ngIf="msg.sender === 'ai'">
            <span
              class="flex align-items-center justify-content-center bg-primary-100 text-primary-700 border-circle chat-avatar w-2rem h-2rem"
            >
              <i class="pi pi-comment text-lg"></i>
            </span>
          </ng-container>
          <div
            [ngClass]="
              msg.sender === 'user'
                ? 'bg-primary-100 text-primary-900 border-round-lg px-3 py-2'
                : 'bg-gray-200 text-gray-800 border-round-lg px-3 py-2'
            "
          >
            <ng-container *ngIf="msg.sender === 'ai'; else userMsg">
              <ng-container *ngIf="msg.text === '...'; else aiAnswer">
                <span class="pi pi-spinner pi-spin"></span>
              </ng-container>
              <ng-template #aiAnswer>
                <span [innerHTML]="msg.text | markdown"></span>
              </ng-template>
            </ng-container>
            <ng-template #userMsg>{{ msg.text }}</ng-template>
          </div>
          <ng-container *ngIf="msg.sender === 'user'">
            <span
              class="flex align-items-center justify-content-center bg-primary-100 text-primary-700 border-circle chat-avatar w-2rem h-2rem"
            >
              <i class="pi pi-user text-lg"></i>
            </span>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
  <div
    class="flex justify-content-center w-full align-items-center h-8rem sticky-bottom-bar bg-gray-50"
  >
    <p-card [ngClass]="'chat-width m-3'">
      <ng-template pTemplate="content">
        <div class="flex align-items-end">
          <textarea
            [(ngModel)]="userMessage"
            placeholder="Type your message..."
            rows="2"
            class="p-inputtext mr-2 flex-1 min-h-3rem w-full resize-none"
          ></textarea>
          <button
            pButton
            type="button"
            icon="pi pi-send"
            class="p-button-text p-button-plain text-primary"
            (click)="sendMessage()"
          ></button>
        </div>
      </ng-template>
    </p-card>
  </div>
</div>
